#!/bin/bash
# AIによる自動コミットメッセージを検出して削除するフック
# AI Instruction Kitsプロジェクト提供

COMMIT_MSG_FILE=$1
COMMIT_SOURCE=$2

# コミットメッセージを読み込む
MESSAGE=$(cat "$COMMIT_MSG_FILE")

# AIツールのサインを検出するパターン
AI_PATTERNS=(
    "🤖 Generated with"
    "Co-Authored-By: Claude"
    "Co-Authored-By: GPT"
    "Co-Authored-By: Gemini"
    "Generated by AI"
    "AI-generated"
    "🤖"
)

# AIサインが含まれているかチェック
for pattern in "${AI_PATTERNS[@]}"; do
    if echo "$MESSAGE" | grep -q "$pattern"; then
        echo "⚠️  警告: AIによる自動生成コミットメッセージを検出しました"
        echo "❌ コミットを中止します"
        echo ""
        echo "✅ 代わりに以下のいずれかの方法を使用してください:"
        
        # AI指示書キットのcommit.shがあるかチェック
        if [ -f "instructions/ai_instruction_kits/scripts/commit.sh" ]; then
            echo "   bash instructions/ai_instruction_kits/scripts/commit.sh \"あなたのコミットメッセージ\""
        elif [ -f "scripts/commit.sh" ]; then
            echo "   bash scripts/commit.sh \"あなたのコミットメッセージ\""
        fi
        
        echo "   git commit -m \"あなたのコミットメッセージ\""
        echo ""
        echo "手動でコミットメッセージを書き直してください。"
        exit 1
    fi
done

# 問題なければそのまま続行
exit 0