# エビデンスチェック

レポートや論文の参考文献・引用の妥当性を検証します。

## 実行内容

1. **参考文献の存在確認**
   - リンク先のコンテンツが存在するか
   - アクセス可能かどうか

2. **引用内容の整合性確認**
   - コンテンツが引用内容と合致するか
   - 数値や客観情報が正確か

3. **文脈の適切性確認**
   - 引用が文脈に適しているか
   - 引用元の意図と合致しているか

## 使用方法

```
/evidence-check [ファイルパスまたはテキスト]
```

### 引数なし（全体チェック）

```
/evidence-check
```

カレントディレクトリ配下の文書ファイル（.md, .txt, .tex等）を検索し、
すべての参考文献・引用をチェックします。

### 引数あり（特定箇所チェック）

```
/evidence-check docs/report.md
/evidence-check "第3章の統計データ"
```

指定されたファイルまたは該当箇所のみをチェックします。

## 実行手順

### 1. 対象ファイルの特定

引数が指定されている場合：
- ファイルパスの場合：そのファイルを対象
- テキストの場合：該当する箇所を検索

引数なしの場合：
- カレントディレクトリ以下の文書ファイルを検索
- .md, .txt, .tex, .docx等を対象

### 2. 参考文献の抽出

以下のパターンを検出：
- URLリンク: `http://...`, `https://...`
- 文献引用: `[1]`, `(Smith, 2020)`, `※参考: ...`
- 脚注参照: `^[...]`, footnote形式
- 画像・図表の出典: `出典: ...`, `Source: ...`

### 3. 並列チェック（複数参考文献がある場合）

**Taskツールを活用した並列処理：**

```
対象文献が5つ以上ある場合は、Taskツールで複数の調査エージェントを
並列起動し、効率的にチェックします。
```

各エージェントは以下を実行：
- WebFetchツールでリンク先を取得
- 引用内容との整合性を確認
- 結果をレポート

### 4. 整合性の検証

各参考文献について：
1. **アクセス確認**: WebFetchでコンテンツを取得
2. **内容確認**: 引用された数値・情報が存在するか
3. **文脈確認**: 引用の使い方が適切か

### 5. レポート生成

チェック結果を以下の形式で出力：

```markdown
## エビデンスチェック結果

### ✅ 問題なし（X件）

| 箇所 | 参考文献 | 確認内容 |
|------|----------|----------|
| p.5 | https://example.com/data | 統計データ一致 |

### ⚠️ 要確認（Y件）

| 箇所 | 参考文献 | 問題点 |
|------|----------|--------|
| p.12 | https://old-site.com | リンク切れ |
| p.20 | (Smith, 2020) | 数値に微妙な差異 |

### ❌ 問題あり（Z件）

| 箇所 | 参考文献 | 問題点 |
|------|----------|--------|
| p.15 | https://404.com | ページが存在しない |
| p.25 | (Jones, 2019) | 引用内容と原文が不一致 |

## 推奨アクション

1. リンク切れの修正
2. 数値の再確認
3. 不一致箇所の訂正または削除
```

## 使用例

### 例1: 特定ファイルのチェック

```
/evidence-check docs/research-paper.md
```

→ research-paper.md内のすべての参考文献をチェック

### 例2: 特定章のチェック

```
/evidence-check "第3章 実験結果"
```

→ 第3章に関連する参考文献のみをチェック

### 例3: プロジェクト全体のチェック

```
/evidence-check
```

→ すべての文書ファイルの参考文献をチェック

## 実装の詳細

### 並列処理の判断基準

```
参考文献数が5件以上の場合：
  → Taskツールで並列チェック（最大5エージェント同時実行）

参考文献数が5件未満の場合：
  → 順次チェック
```

### チェック項目の優先度

**高優先度（必須）：**
- リンク先の存在確認
- 数値データの一致確認

**中優先度（推奨）：**
- 文脈の適切性
- 引用元の意図との整合性

**低優先度（任意）：**
- 引用形式の統一性
- 参考文献リストの完全性

## 注意事項

- WebFetchの制限により、一部のサイトはアクセスできない場合があります
- 動的コンテンツ（JavaScript必須）は正しく取得できない可能性があります
- 有料コンテンツや認証が必要なページはチェックできません
- 大量の参考文献（50件以上）がある場合、処理に時間がかかります

## エラーハンドリング

- **ネットワークエラー**: 一時的な問題の可能性を示唆
- **404エラー**: リンク切れとして報告
- **アクセス拒否**: 認証が必要な可能性を示唆
- **タイムアウト**: サイトの応答が遅い可能性を示唆

---

**重要**: このコマンドは参考文献の技術的な妥当性をチェックしますが、
学術的・専門的な内容の正確性については、専門家によるレビューが必要です。
