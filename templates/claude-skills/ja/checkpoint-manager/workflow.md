# チェックポイント ワークフロー詳細

## 標準ワークフロー

```
┌─────────────────────────────────────────────────────────────┐
│ 1. 会話開始                                                 │
│    └─ pending で未完了タスクを確認                          │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│ 2. タスク開始                                               │
│    └─ start でタスクを登録（タスクID自動生成）              │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│ 3. 指示書選択                                               │
│    ├─ instruction-start で指示書使用を記録                  │
│    └─ 指示書を読み込み、作業を実行                          │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│ 4. 進捗報告（繰り返し）                                     │
│    └─ progress で状況を更新（指示書使用中のみ）             │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│ 5. 指示書完了                                               │
│    └─ instruction-complete で指示書使用を完了               │
└─────────────────────────────────────────────────────────────┘
                            ↓
┌─────────────────────────────────────────────────────────────┐
│ 6. タスク完了                                               │
│    └─ complete でタスクを終了（全指示書完了が必要）         │
└─────────────────────────────────────────────────────────────┘
```

## コマンド詳細

### pending - 未完了タスクの確認

```bash
scripts/checkpoint.sh pending
```

**出力例:**
```
📋 未完了タスク一覧
┌──────────────────────┬────────────────┬─────────┐
│ タスクID             │ タスク名       │ 進捗    │
├──────────────────────┼────────────────┼─────────┤
│ TASK-123456-abc123   │ API実装        │ 2/5     │
└──────────────────────┴────────────────┴─────────┘
```

### start - タスク開始

```bash
scripts/checkpoint.sh start "<タスク名>" <ステップ数>
```

**引数:**
- `<タスク名>`: 作業内容の簡潔な説明
- `<ステップ数>`: 予想される作業ステップ数

**出力例:**
```
🚀 タスク開始: API実装
📝 タスクID: TASK-123456-abc123
📊 推定ステップ: 5
```

### instruction-start - 指示書使用開始

```bash
scripts/checkpoint.sh instruction-start "<path>" "<purpose>" [task-id]
```

**引数:**
- `<path>`: 指示書のパス
- `<purpose>`: 使用目的
- `[task-id]`: タスクID（省略可能だが推奨）

**出力例:**
```
📚 指示書使用開始: web_api_production.md
   目的: REST API開発
📌 タスクID: TASK-123456-abc123
```

### progress - 進捗報告

```bash
scripts/checkpoint.sh progress <task-id> <current> <total> "<status>" "<next>"
```

**引数:**
- `<task-id>`: タスクID
- `<current>`: 現在のステップ
- `<total>`: 全ステップ数
- `<status>`: 現在の状況
- `<next>`: 次のアクション

**制約:** 指示書使用中のみ実行可能

**出力例:**
```
[2/5] 設計完了 | 次: 実装開始
📌 タスクID: TASK-123456-abc123
```

### instruction-complete - 指示書使用完了

```bash
scripts/checkpoint.sh instruction-complete "<path>" "<result>" [task-id]
```

**引数:**
- `<path>`: 指示書のパス
- `<result>`: 成果
- `[task-id]`: タスクID

**出力例:**
```
✅ 指示書使用完了: web_api_production.md
📊 成果: 3エンドポイント実装完了
📌 タスクID: TASK-123456-abc123
```

### complete - タスク完了

```bash
scripts/checkpoint.sh complete <task-id> "<result>"
```

**引数:**
- `<task-id>`: タスクID
- `<result>`: 最終成果

**制約:** すべての指示書が完了している必要あり

**出力例:**
```
✅ タスク完了: TASK-123456-abc123
📊 成果: REST API 3エンドポイント実装、テスト10個作成
```

### error - エラー報告

```bash
scripts/checkpoint.sh error <task-id> "<message>"
```

**引数:**
- `<task-id>`: タスクID
- `<message>`: エラー内容

**出力例:**
```
❌ エラー報告: TASK-123456-abc123
   依存関係エラー: package not found
```

### summary - 詳細履歴

```bash
scripts/checkpoint.sh summary <task-id>
```

タスクの全履歴（開始、進捗、指示書使用、完了）を時系列で表示。

## エラーハンドリング

| エラー | 原因 | 対処 |
|--------|------|------|
| 進捗報告失敗 | 指示書未使用 | instruction-start を先に実行 |
| タスク完了失敗 | 指示書未完了 | instruction-complete を先に実行 |
| タスクID不明 | 存在しないID | pending で確認 |

## ログファイル

チェックポイントのログは以下に保存：

```
.ai_checkpoints/
├── tasks/
│   └── TASK-123456-abc123.json
└── instructions/
    └── usage.log
```
