# 指示書検索・フィルタリング機能 開発計画

## 概要
AI指示書キットに検索・フィルタリング機能を追加し、指示書が増えても必要なものを素早く見つけられるようにする。

## 開発目標
1. **タグベースの分類システム**
2. **キーワード検索機能**
3. **依存関係の可視化**
4. **使用頻度に基づく推奨**

## フェーズ1: 基盤構築（推定: 1週間）

### 1.1 メタデータシステムの設計
- 各指示書にメタデータを追加する仕組み
- YAMLフロントマターを活用
- 必要なメタデータ項目：
  ```yaml
  ---
  tags: [coding, python, api]
  dependencies: [basic_code_generation.md]
  category: coding
  difficulty: intermediate
  created: 2025-01-05
  updated: 2025-01-05
  ---
  ```

### 1.2 検索インデックスの構築
- `scripts/build-index.sh` - インデックス構築スクリプト
- JSON形式でインデックスを保存
- 構造例：
  ```json
  {
    "instructions": [
      {
        "path": "instructions/ja/coding/basic_code_generation.md",
        "title": "基本的なコード生成",
        "tags": ["coding", "basic"],
        "content_preview": "...",
        "dependencies": [],
        "last_updated": "2025-01-05"
      }
    ]
  }
  ```

### 1.3 基本検索ツールの実装
- `scripts/search-instruction.sh` - コマンドライン検索ツール
- 基本的なキーワード検索
- タグによるフィルタリング

## フェーズ2: 検索機能の実装（推定: 1週間）

### 2.1 高度な検索機能
- 正規表現対応
- 複数条件でのAND/OR検索
- カテゴリ別フィルタリング
- 言語別フィルタリング

### 2.2 検索結果の表示改善
- 関連度スコアリング
- ハイライト表示
- プレビュー機能
- 検索結果のエクスポート

### 2.3 インタラクティブ検索UI
- `scripts/interactive-search.sh` - 対話型検索ツール
- fzfやpecoなどの活用
- リアルタイムプレビュー

## フェーズ3: 依存関係の可視化（推定: 1週間）

### 3.1 依存関係グラフの生成
- `scripts/generate-dependency-graph.sh`
- Graphviz形式での出力
- Mermaid形式での出力（GitHub対応）

### 3.2 依存関係の分析
- 循環依存の検出
- 孤立した指示書の検出
- 依存関係の深さ分析

### 3.3 ビジュアライゼーション
- SVG/PNG形式でのグラフ出力
- インタラクティブなHTMLグラフ
- GitHub Pagesでの公開

## フェーズ4: 使用頻度トラッキング（推定: 1週間）

### 4.1 使用履歴の記録
- `.instruction-usage.log` - 使用履歴ファイル
- プライバシーに配慮した設計
- オプトイン方式

### 4.2 使用統計の分析
- 人気の指示書ランキング
- 使用パターンの分析
- 時系列での使用傾向

### 4.3 推奨システム
- よく一緒に使われる指示書の提案
- プロジェクトタイプに基づく推奨
- 初心者向け/上級者向けの推奨

## フェーズ5: 統合とドキュメント化（推定: 3日）

### 5.1 既存システムとの統合
- setup-project.shへの組み込み
- ROOT_INSTRUCTION.mdとの連携
- チェックポイントシステムとの統合

### 5.2 ドキュメント作成
- 使用ガイドの作成
- APIドキュメント
- トラブルシューティングガイド

### 5.3 テストとデバッグ
- ユニットテストの作成
- 統合テスト
- パフォーマンステスト

## 技術スタック

### 必須
- Bash（基本スクリプト）
- jq（JSON処理）
- grep/ripgrep（検索）

### オプション
- Python（高度な分析機能）
- Node.js（Web UI）
- SQLite（使用履歴DB）

## 成果物

1. **検索ツール群**
   - `search-instruction.sh` - 基本検索
   - `interactive-search.sh` - 対話型検索
   - `build-index.sh` - インデックス構築

2. **分析ツール群**
   - `generate-dependency-graph.sh` - 依存関係グラフ
   - `analyze-usage.sh` - 使用統計分析
   - `recommend-instructions.sh` - 推奨システム

3. **ドキュメント**
   - `SEARCH_GUIDE.md` - 検索機能ガイド
   - `METADATA_SPEC.md` - メタデータ仕様
   - `API_REFERENCE.md` - APIリファレンス

## 実装の優先順位

1. **高優先度**
   - メタデータシステム
   - 基本的なキーワード検索
   - タグフィルタリング

2. **中優先度**
   - 依存関係の可視化
   - インタラクティブ検索

3. **低優先度**
   - 使用頻度トラッキング
   - 推奨システム

## リスクと対策

### リスク
1. パフォーマンス問題（大量の指示書での検索速度）
2. メタデータの保守性
3. 後方互換性の維持

### 対策
1. インデックスのキャッシュとインクリメンタル更新
2. メタデータの自動検証ツール
3. 段階的な機能追加とバージョニング

## マイルストーン

- **M1**: 基本検索機能のリリース（2週間）
- **M2**: 依存関係可視化の追加（3週間）
- **M3**: 使用統計と推奨機能（4週間）
- **M4**: 完全統合版リリース（5週間）

## 次のステップ

1. このプランのレビューと承認
2. フェーズ1の詳細設計
3. プロトタイプの作成
4. ユーザーフィードバックの収集

---
作成日: 2025-01-05
作成者: AI Instruction Kits Development Team