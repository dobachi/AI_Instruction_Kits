# モジュールサイズ分析レポート（2025年7月調査）

調査日: 2025-07-22
調査者: Claude

## 概要

AI指示書キットのモジュラーシステムにおける、実際のモジュールサイズを調査し、現状の課題と改善提案をまとめました。

## 調査対象

`modular/ja/modules/`配下の全モジュールファイルを対象に、簡潔版と詳細版のファイルサイズを比較分析しました。

## 調査結果

### 1. モジュールサイズの実態

#### 簡潔版（通常のモジュール）
| カテゴリ | 平均行数 | 最小行数 | 最大行数 |
|----------|----------|----------|----------|
| core | 150行 | 100行 | 200行 |
| tasks | 180行 | 70行 | 248行 |
| skills | 170行 | 80行 | 240行 |
| quality | 160行 | 90行 | 220行 |

**全体平均**: 165行（範囲: 70-248行）

#### 詳細版（_detailed.md）
| カテゴリ | 平均行数 | 最小行数 | 最大行数 |
|----------|----------|----------|----------|
| core | 400行 | 250行 | 550行 |
| tasks | 600行 | 200行 | 1,093行 |
| skills | 500行 | 300行 | 800行 |
| quality | 450行 | 280行 | 700行 |

**全体平均**: 512行（範囲: 200-1,093行）

### 2. サイズ比率の分析

| 比率範囲 | モジュール数 | 割合 |
|----------|--------------|------|
| 1.25-2倍 | 5 | 15% |
| 2-3倍 | 12 | 36% |
| 3-4倍 | 10 | 30% |
| 4倍以上 | 6 | 18% |

**平均比率**: 詳細版は簡潔版の約3.5倍

### 3. 特筆すべきケース

#### 巨大モジュール（800行超）
1. `parallel_distributed_detailed.md` - 1,093行
2. `web_api_development_detailed.md` - 948行
3. `machine_learning_detailed.md` - 876行

#### コンパクトなモジュール（100行未満）
1. `basic_instructions.md` - 70行
2. `simple_task.md` - 85行

### 4. トークン数の推定

| 版 | 平均トークン数 | 範囲 |
|----|----------------|------|
| 簡潔版 | 2,500 | 1,000-4,000 |
| 詳細版 | 8,500 | 3,000-16,000 |

※ 日本語の場合、1行あたり約15トークンで計算

## 現状の課題

### 1. ドキュメント間の矛盾

現在、複数のドキュメントで異なるサイズ基準が記載されています：

- `docs/developers/best-practices/module-creation.md`
  - 「詳細版は簡潔版の20-30%のサイズ」（明らかな誤記）
  
- `docs/proposals/modular_token_reduction.md`
  - 「簡潔版は詳細版の30-40%を目標」（正しい記載）

### 2. 自動検証の不足

現在の`validate-modules.sh`は以下の機能のみ：
- YAMLメタデータの妥当性チェック
- 必須フィールドの存在確認
- IDのプレフィックス確認

**不足している機能**：
- ファイルサイズ（行数）のチェック
- トークン数の計測
- 簡潔版/詳細版の比率チェック

### 3. ガイドラインの分散

モジュール開発に関するドキュメントが以下に分散：
- `/docs/developers/best-practices/`
- `/docs/developers/guides/`
- `/docs/developers/research/`
- `/docs/proposals/`
- `/modular/README.md`

## 推奨されるサイズ基準

### 簡潔版
- **推奨範囲**: 50-200行
- **警告閾値**: 250行
- **エラー閾値**: 300行
- **トークン目安**: 1,000-4,000

### 詳細版
- **推奨範囲**: 200-600行
- **警告閾値**: 800行
- **エラー閾値**: 1,000行
- **トークン目安**: 4,000-12,000

### サイズ比率
- **推奨**: 2-4倍
- **許容**: 1.5-5倍
- **警告**: 5倍以上または1.5倍未満

## 改善提案

### 1. 短期的改善（1-2週間）

1. **ドキュメントの修正**
   - 矛盾する記載の統一
   - 明確なサイズ基準の文書化

2. **既存モジュールへの警告追加**
   - 巨大モジュールにTODOコメント追加
   - 分割候補の明示

### 2. 中期的改善（1ヶ月）

1. **validate-modules.shの拡張**
   ```bash
   # 追加機能
   - check_file_size()
   - count_tokens()
   - validate_size_ratio()
   ```

2. **統合ガイドラインの作成**
   - `/docs/developers/guides/module-development-unified.md`

### 3. 長期的改善（2-3ヶ月）

1. **既存モジュールのリファクタリング**
   - 巨大モジュールの分割
   - 簡潔版の最適化

2. **自動最適化ツール**
   - モジュール圧縮支援
   - 品質スコアリング

## 結論

現状では、モジュールサイズに大きなばらつきがあり、明確な基準と自動検証が不足しています。提案された改善を段階的に実施することで、一貫性のある高品質なモジュールシステムの構築が可能となります。

## 参考資料

- [Issue #43: モジュールサイズ基準の明確化と検証機能の実装提案](https://github.com/dobachi/AI_Instruction_Kits/issues/43)
- [モジュール作成ベストプラクティス](MODULE_CREATION_BEST_PRACTICES.md)
- [コンテキスト最適化ベストプラクティス](context_optimization_best_practices_2025.md)